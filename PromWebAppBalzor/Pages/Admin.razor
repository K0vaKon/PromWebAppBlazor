@page "/admin-panel"
@inject HttpClient Http

<div class="admin-container">
    <h3>Admin panel (@(pendingPhotos?.Count ?? 0))</h3>

    @if (pendingPhotos == null)
    {
        <div class="spinner-border text-primary" role="status"></div>
    }
    else
    {
        <div class="photo-grid">
            @foreach (var photo in pendingPhotos)
            {
                <div class="photo-card">
                    <div class="photo-wrapper">
                        @* 1. loading="lazy" — browser loads photo only when scrolling *@
                        @* 2. decodings="async" — does not block the UI while processing the image *@
                        <img src="http://localhost:5036/uploads/@photo"
                             loading="lazy"
                             decoding="async"
                             alt="Pending photo" />
                    </div>
                    <div class="photo-info">
                        <span class="user-name">👤 @photo</span>
                    </div>
                    <div class="actions">
                        <button class="btn-approve" @onclick="() => Approve(photo)">Approve</button>
                        <button class="btn-reject" @onclick="() => Reject(photo)">Reject</button>
                    </div>
                </div>
            }
        </div>
    }
</div>

@code {
    private List<string> pendingPhotos = new List<string>();

    protected override async Task OnInitializedAsync() => await LoadPending();

    async Task LoadPending() =>
        pendingPhotos = await Http.GetFromJsonAsync<List<string>>("http://localhost:5036/api/Photo/pending");

    async Task Approve(string name)
    {
        var response = await Http.PostAsync($"http://localhost:5036/api/Photo/approve/{name}", null);
        if (response.IsSuccessStatusCode)
        {
            pendingPhotos?.Remove(name);
        }
    }

    async Task Reject(string name)
    {
        // FIXED: Changed "rejected" to "reject" to match the Controller route
        var response = await Http.PostAsync($"http://localhost:5036/api/Photo/reject/{name}", null);

        if (response.IsSuccessStatusCode)
        {
            pendingPhotos?.Remove(name);
        }
        else
        {
            // Log error to console for debugging
            Console.WriteLine($"Reject failed with status: {response.StatusCode}");
        }
    }
}