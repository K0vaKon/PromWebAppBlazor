@page "/galerij"
@using PromWebAppBalzor.Models
@using System.Text.Json
@inject HttpClient Http

<div class="container text-center">
    <h1 class="mt-4 mb-4">Bal Foto's</h1>

    @if (errorMessage != null)
    {
        <div class="alert alert-danger">
            <strong>Ошибка связи с сервером:</strong> @errorMessage
        </div>
    }

    @if (photos == null && errorMessage == null)
    {
        <div class="spinner-border text-primary" role="status"></div>
        <p>Laden...</p>
    }
    else if (photos != null && !photos.Any())
    {
        <p>Er zijn еще geen foto's geüpload...</p>
    }
    else if (photos != null)
    {
        <div class="pinterest-grid">
            @foreach (var photo in photos)
            {
                <div class="pinterest-item">
                    <div class="card shadow-sm">
                        <img src="@($"http://localhost:5036/approved/{photo.FileName}")"
                             class="card-img-top"
                             alt="Bal foto" />

                        <div class="card-body p-2 text-center">
                            @* Возвращаем подпись под фото *@
                            <small class="text-muted">@(photo.Sender?.Name ?? "Anoniem")</small>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@code {
    private List<Photo>? photos;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var options = new JsonSerializerOptions { PropertyNameCaseInsensitive = true };

            // Пытаемся получить данные
            var result = await Http.GetFromJsonAsync<List<Photo>>("http://localhost:5036/api/Photo", options);

            photos = result;
        }
        catch (Exception ex)
        {
            // Сохраняем текст ошибки, чтобы увидеть его на экране
            errorMessage = ex.Message;
            Console.WriteLine($"Full error info: {ex}");
        }
    }
}